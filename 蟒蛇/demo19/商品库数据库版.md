## 商品库数据库版

### 一、框架

总共分为两个文件，我愿称之为工具文件和主文件

#### 1.工具文件MysqlHelper

在这个文件里面

首先需要引入pymysql库，然后封装一个类，类里连接上需要连接的数据库，然后定义各种方法，用来实现各种功能

***方法包括:*** 

取一条数据		get_one()

取多条数据		get_all()

增加数据			insert()

修改数据			update()

删除数据			delete()

创建表				create_table()



***还有私有方法：***

建立数据库连接和打开游标		__connect()

关闭游标和连接							__close()

用于增删改数据，创						__edit()



这个就先只需知道他的功能有哪些就行了,就当成一个库来看，要记住的是，每次调用里面的方法的时候都会打开和关闭与数据库的连接



#### 2.主文件

主要有七大功能

![image-20220320121305898](https://gitee.com/buguai_lxw/key/raw/master/202203201213968.png)



### 二、具体实现

#### 1.准备

首先先引入工具文件，并用shoper表示，之后就可以之间用shoper调用那些功能了。因为工具文件中已经引用了pymysql的库了，这个位置就不需要了

```python
from MysqlHelper import *
shoper = MysqlHelper(MysqlHelper.conn_paramsl)
```

再引用一个time库，并存一下当前时间，后面需要

```python
import time
init_time=time.time()
```

再创建几个库，不过只第一次需要，之后又注释掉了

```python
# # 创建商品库
# sql="create table shop(商品号 bigint(%s) not null primary key,商品名 varchar(10) not null,售价 decimal(10,2) not null,进价 decimal(10,2));"
# shoper.create_table(sql,14)
#
# # 创建数量库
# sql="create table nums(商品号 bigint(%s) not null primary key,进货数量 int(6) not null,卖出数量 int(6) not null,库存数量 int(6) not null);"
# shoper.create_table(sql,14)
#
# # 创建利润库
# sql="create table money_pure(商品号 bigint(%s) not null primary key,利润 decimal(6,2));"
# shoper.create_table(sql,14))
```



#### 2.进货

![image-20220320130818832](https://gitee.com/buguai_lxw/key/raw/master/202203201308893.png)



#### 3.售卖

![image-20220320131731134](https://gitee.com/buguai_lxw/key/raw/master/202203201317183.png)



#### 4.修改

![image-20220320140454266](https://gitee.com/buguai_lxw/key/raw/master/202203201404316.png)



#### 5.查找

![image-20220320141525309](https://gitee.com/buguai_lxw/key/raw/master/202203201415364.png)



#### 6.备份

利用商品名＋时间的方式为复制的表取名，并把三张表都备份一下



#### 7.日报

![image-20220320133527215](https://gitee.com/buguai_lxw/key/raw/master/202203201335260.png)



#### 8.每日更新功能

最开始有一个init_time,代表的是从1970-1-1 00：00：00到现在度过的秒数，也称为时间撮

然后再while循环，这个时候读取时间撮

```python
now_time=time.time()
```

如果两个时间撮相差300，就判断一下日期是否改变

```python
sql="select datetime from time where datetime>%s"
time_init_day=str(shoper.get_one(sql,0)[0])[8:]
time_now_day= str(time.strftime("%d"))
```

如果日期改变了，说明到了新的一天，就先备份前一天数据，然后清0进出货和利润

```python
if time_now_day!=time_init_day:
    time_init_day=str(time.strftime("%Y-%m-%d"))
    sql="update time set datetime=%s"
    shoper.insert(sql,time_init_day)
    copy()
    sql="update nums set 进货数量=%s,卖出数量=%s"
    shoper.update(sql,(0,0))
    sql = "update money_pure set 利润=%s"
    shoper.update(sql, 0)
```

再之后就是把init_time变成当前的时间，用于实现判断的时间至少隔了五分钟

```python
init_time=now_time
```